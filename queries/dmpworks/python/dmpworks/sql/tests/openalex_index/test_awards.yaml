test_openalex_index_awards:
  model: openalex_index.awards
  inputs:
    openalex_index.works_metadata:
      rows:
        - id: "W0000000001"
          doi: "10.9999/test.0001"
        - id: "W0000000002"
          doi: "10.9999/test.0002"
        - id: "W0000000003"
          doi: "10.9999/test.0003"
    crossref_metadata.works_funders:
      rows:
        - work_doi: "10.9999/test.0001"
          award: "1"
        - work_doi: "10.9999/test.0002"
          award: "2"
        - work_doi: "10.9999/test.0002"
          award: null
    openalex.works:
      rows:
        - id: "W0000000001"
          grants:
            - award_id: "3"
        - id: "W0000000001"  # nulls should be filtered out
          grants:
            - award_id: null
        - id: "W0000000001"  # duplicates should be filtered out
          grants:
            - award_id: "1"
        - id: "W0000000002"
          grants:
            - award_id: "4"
        - id: "W0000000002" # duplicates should be filtered out
          grants:
            - award_id: "2"
  outputs:
    query:
      rows:
        - doi: "10.9999/test.0001"
          awards:
            - award_id: "1"
            - award_id: "3"
        - doi: "10.9999/test.0002"
          awards:
            - award_id: "2"
            - award_id: "4"

